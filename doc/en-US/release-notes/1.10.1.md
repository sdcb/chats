<!-- Language: en-US -->
<p><a href="./README.md">ğŸ“‹ All Versions</a> <span style="float:right"><b>English</b> | <a href="../../zh-CN/release-notes/1.10.1.md">ç®€ä½“ä¸­æ–‡</a></span></p>

# Chats 1.10.1 Release Notes

> Release Date: 2026-02-15 (82 commits since main)

1.10.1 is a feature and UX iteration after 1.10.0, focused on **Sandbox Manager enhancements**, **server-side ETag caching**, **ChatMiniMap navigation**, **API key management improvements**, and **file download experience upgrades**. On the backend, it also includes a `ThinkTagParser` rewrite, unified `HttpClientFactory` usage, and Docker session model refactoring.

## ğŸ¯ Core Features

### 1) Sandbox Manager Enhancements

- ğŸ·ï¸ **Rename**: `Session Manager` is renamed to `Sandbox Manager`.
- ğŸ“‹ **Session info card**: New `SessionInfoCard` with image/CPU/memory/pid/network/IP/create-expire time details and touch refresh.
- ğŸŒ **Environment variables editor**: New `SessionEnvVarEditor` with table/raw modes, validation, duplicate checks, and unsaved-change guards. Backend adds `GET/PUT /{encryptedSessionId}/environment-variables`.
- ğŸ“‚ **File management performance**: Directory listing switches to `ls -la --full-time` command path instead of archive listing; adds `DockerOutputParser` for Linux/Windows output.
- ğŸ—‘ï¸ **Delete session**: New endpoint and UI flow for deleting Docker sessions.
- ğŸ”— **OwnerChatId binding**: `ChatDockerSession` now supports direct Chat binding via `OwnerChatId`, enabling session creation before any turn exists.
- ğŸ“Š **Tabbed layout**: Info / Env / Command / Files / Editor with state retention across tab switches.
- ğŸ³ **Image pull progress**: Better progress visibility when pulling images.
- ğŸ› ï¸ **Bug fixes**: Session termination sync, duplicate file loading, drag-upload issues, and download path issues.
- ğŸ“¦ **Default image strategy update**: `CodeInterpreter:DefaultImage` defaults to `sdcb/code-interpreter:latest`.

### 2) Server-side ETag Caching

- âš¡ **EtagCacheHelper**: Adds `XxHash128`-based ETag generation and `304 Not Modified` handling.
- ğŸ“¡ **Applied to high-frequency APIs**: `GET /api/models`, `GET /api/prompts` (brief/default), `GET /api/messages/{chatId}`, `GET /api/user-chats/groups`.
- ğŸ—‘ï¸ **Frontend cache removal**: Removes `chatCache.ts` localStorage chat cache; cache consistency is now driven by server ETag.

### 3) ChatMiniMap Navigation

- ğŸ—ºï¸ **New `ChatMiniMap`**: Right-side message mini-map for fast navigation by user/assistant message distribution.
- â¬†ï¸â¬‡ï¸ **Scroll controls moved**: Top/bottom/previous-user-message controls are moved out of `ChatInput` into `ChatMiniMap`.

### 4) API Key Management Improvements

- ğŸ” **Creation flow**: New `ApiKeyDialog` supports name + expiry inputs and one-time full key display after creation.
- âœï¸ **Edit support**: API key comment and expiry can be updated.
- ğŸ“‹ **Bulk copy**: Adds "copy all keys".
- ğŸ”’ **Backend safety**: List API returns masked keys only (`ToMasked()`); creation uses `CreateApiKeyDto` (`comment`, `expires`).

### 5) File Download Experience

- ğŸ“ **Content-Disposition**: Aliyun OSS / AWS S3 / Azure Blob / local file service now preserve original filename for downloads.
- ğŸ”§ **Local service fix**: Fixes missing Content-Disposition in local file downloads.

---

## ğŸ—ï¸ Architecture & Engineering

### 1) ThinkTagParser Rewrite

- Reworked from raw string token parsing to `ChatSegment` stream parsing. Non-text segments (e.g., tool calls) pass through directly.
- Adds `ThinkTagParserTests` coverage for edge cases.

### 2) Unified HttpClient Injection

- Backend HTTP calls are unified through `IHttpClientFactory` (including `ImageChatSegment`, `ImageGenerationService`) to reduce socket exhaustion risks.

### 3) Code Interpreter Image Pipeline Enhancements

- Adds `RUN_NUMBER` build arg/env injection and includes rv marker in rendered `skills.md` for traceability.
- Adds `ripgrep (rg)` to the pre-installed image toolset.
- CI now creates/pushes `latest` manifest for non-main branches as well (useful for branch validation).

### 4) Docker Service Interface Refactor

- Simplifies `IDockerService`: removes `WrapDockerOperationAsync`, promotes `ListDirectoryAsync` to interface-level behavior, removes redundant Docker exception wrappers.
- Docker session APIs move to encrypted session IDs (`encryptedSessionId`).
- Adds `BytesFormatter` for resource size formatting.

### 5) Admin API Consolidation

- Unifies admin/user generation info path through `GET /api/messages/{chatId}` and removes dedicated admin turn info route.

### 6) Keycloak Refactor

- Introduces `KeycloakOAuthClient` and decouples OAuth logic from config holder objects.

---

## ğŸ¨ Frontend UX Improvements

### ChatInput

- Upload actions are moved into a `+` popover for cleaner layout.
- Adds `CodeExecutionControl` for bulk model code-execution toggling, with quick entry to Sandbox Manager.
- Moves agent link to the bottom area.

### ChatMessage

- Delete action shows loading state.
- Adds `ExpandTextAction` for long text expansion/collapse.
- Improves assistant message min-height behavior to reduce visual jumps.
- Removes 3 `requestAnimationFrame` usages.
- Auto-scrolls user messages to top on send/chat selection and adds adaptive bottom spacing.
- Tool call blocks auto-collapse when subsequent content appears.

### Settings

- Theme/language selectors are refactored into segmented controls.
- Adds font size setting (12â€“18px slider + input), persisted in localStorage via `--chat-font-size`.

### File Service Management

- Configuration values are masked by default (`maskJsonValues`) and switch to editable plaintext when editing.
- Adds a **Validate** action to test file-service connectivity before saving.
- Aligns add-button visual style with model management UI.

### Cost Display Optimization

- Removes RMB symbol (`ï¿¥`) from cost displays and keeps numeric values only for multi-currency friendliness.

### Others

- Default send mode changes from `Enter` to `Ctrl+Enter`.
- Fixes `Maximum update depth exceeded` refresh issue.
- Fixes ChatInput height overlap regression.
- Fixes long WeChat browser UserAgent issue (column expanded to 500 chars).
- Adds debounce for user query filtering in admin messages page.
- Upgrades `baseline-browser-mapping` to `2.9.19`.

---

## ğŸ› Stability Fixes

- Fixes 16 unit tests affected by EF Core `ExecuteUpdateAsync` unsupported in InMemory provider.
- Fixes Docker session termination persistence issue.
- Fixes duplicate file list loading and drag-upload bugs.
- Fixes Chinese character sync issue.

---

## â¬†ï¸ Upgrade Notes

- Run DB migration: `src/scripts/db-migration/1.10/1.10.1.sql`
  - Expand `ClientUserAgent.UserAgent` length to 500
  - Add `OwnerChatId` to `ChatDockerSession` with FK/index and migrate data from `OwnerTurnId`
- Default config changed: `CodePod:OutputOptions:MaxOutputBytes` is now `8192` (from `6144`). If you have custom overrides, verify them.
