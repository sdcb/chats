<!-- Language: zh-CN -->
<p><a href="./README.md">ğŸ“‹ æ‰€æœ‰ç‰ˆæœ¬</a> <span style="float:right"><a href="../../en-US/release-notes/1.10.0.md">English</a> | <b>ç®€ä½“ä¸­æ–‡</b></span></p>

# Chats 1.10.0 å‘å¸ƒè¯´æ˜

> å‘å¸ƒæ—¥æœŸï¼š2026-01-14ï¼ˆç›¸å¯¹ main ä»¥æ¥ 111 æ¬¡æäº¤ï¼‰

1.10.0 æ˜¯ä¸€æ¬¡å›´ç»• **å†…ç½® Code Interpreterï¼ˆDocker æ²™ç®±ï¼‰** çš„é‡å¤§èƒ½åŠ›å‡çº§ï¼šæ–°å¢ `sdcb/code-interpreter` é»˜è®¤é•œåƒä¸é…å¥— CIï¼Œåç«¯å¼•å…¥ä¼šè¯ç®¡ç†ä¸å®‰å…¨èµ„æºé™åˆ¶ï¼Œå‰ç«¯å¯¹å·¥å…·è°ƒç”¨å±•ç¤ºã€æ–‡ä»¶ä¸Šä¼ /é¢„è§ˆã€ç”Ÿæˆä¿¡æ¯ä¸ç®¡ç†é¡µé¢åšäº†ç³»ç»Ÿæ€§ä¼˜åŒ–ã€‚åŒæ—¶ï¼Œç»§ç»­æ‰©å±•å¤šæ¨¡å‹æä¾›å•†åœ¨å·¥å…·è°ƒç”¨åœºæ™¯ä¸‹çš„ **äº¤é”™æ€è€ƒï¼ˆInterleaved Thinkingï¼‰å›ä¼ èƒ½åŠ›**ï¼Œå¹¶è®© Chat Completions API å…¼å®¹ DeepSeek v3.2 é£æ ¼çš„ `reasoning_content`ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1) å†…ç½® Docker Code Interpreterï¼ˆæ²™ç®±æ‰§è¡Œç¯å¢ƒï¼‰

- ğŸ³ **å†…ç½®å·¥å…·é›†**ï¼šæ–°å¢ä¸€ç»„åŸºäº Docker çš„å†…ç½®å·¥å…·ï¼Œæ”¯æŒåœ¨ä¼šè¯å†…æ‰§è¡Œä»£ç ä¸æ–‡ä»¶æ“ä½œï¼ˆ`create_docker_session` / `run_command` / `read_file` / `write_file` / `patch_file` / `download_chat_files` / `destroy_session`ï¼‰ã€‚
- ğŸ“¦ **é»˜è®¤é•œåƒ `sdcb/code-interpreter`**ï¼šä½œä¸ºå¼€ç®±å³ç”¨çš„ Code Interpreter ç¯å¢ƒï¼Œåœ¨é•œåƒä¸­é¢„ç½®å¸¸ç”¨ä¾èµ–ä¸å·¥å…·é“¾ï¼ˆdotnet/python/node/gcc/sqlite3ã€LibreOffice/Pandoc/Popplerã€FFmpegã€Playwright Chromiumã€å¸¸ç”¨å­—ä½“ã€ImageMagick ç­‰ï¼‰ï¼Œå¹¶é›†æˆ `anthropics/skills`ï¼ˆ`/app/skills` ä¸ `/app/skills.md`ï¼‰ã€‚
- ğŸ” **å®‰å…¨ä¸èµ„æºé™åˆ¶**ï¼šæ”¯æŒä¼šè¯çº§èµ„æºé™åˆ¶ï¼ˆå†…å­˜/CPU/è¿›ç¨‹æ•°ï¼‰ã€è¶…æ—¶ã€é—²ç½®å›æ”¶ï¼›å¹¶æä¾›ç½‘ç»œæ¨¡å¼ç™½åå•æ§åˆ¶ï¼ˆ`DefaultNetworkMode` / `MaxAllowedNetworkMode`ï¼‰ã€‚
- ğŸ§¾ **ä¼šè¯å¯è¿½è¸ª**ï¼šå¼•å…¥ `ChatDockerSession` æŒä¹…åŒ–è®°å½•ï¼ˆå®¹å™¨ ID / é•œåƒ / shell å‰ç¼€ / IP / èµ„æº / åˆ°æœŸæ—¶é—´ç­‰ï¼‰ï¼Œå¹¶é€šè¿‡åå°æœåŠ¡è‡ªåŠ¨æ¸…ç†è¿‡æœŸå®¹å™¨ï¼ˆ`ChatDockerSessionCleanupService`ï¼‰ã€‚
- ğŸ“ **äº‘æ–‡ä»¶æ³¨å…¥ + ä¸€é”®ä¸‹è½½**ï¼šä»…å°†â€œæœ¬è½®ä¸Šä¸‹æ–‡â€ç›¸å…³äº‘æ–‡ä»¶æ³¨å…¥åˆ°æç¤ºè¯å‰ç¼€ï¼Œå¹¶æ”¯æŒ `download_chat_files` å°†å†å²æ–‡ä»¶æŒ‰é€šé…ç¬¦ä¸‹è½½åˆ°å®¹å™¨ `/app`ï¼Œé…åˆ `artifacts` ç›®å½•è®©ç”¨æˆ·ç›´æ¥ä¸‹è½½è¾“å‡ºç»“æœã€‚

### 2) äº¤é”™æ€è€ƒï¼ˆInterleaved Thinkingï¼‰èƒ½åŠ›æ‰©å±•

- ğŸ§  **æ›´å¤šæä¾›å•†æ”¯æŒå·¥å…·è°ƒç”¨æ€è€ƒå›ä¼ **ï¼šåœ¨ Chat Completions API ä¸‹ï¼ŒMoonshotï¼ˆKimiï¼‰ç­‰æä¾›å•†æ–°å¢/å®Œå–„äº†åœ¨å·¥å…·è°ƒç”¨ä¹‹é—´å›ä¼  `reasoning_content` çš„èƒ½åŠ›ï¼ˆä¸ DeepSeek/MiMo çš„åšæ³•ä¿æŒä¸€è‡´ï¼‰ã€‚
- ğŸ” **Chat Completions API å…¼å®¹ DeepSeek v3.2 é£æ ¼**ï¼šè§£æä¸ä¿å­˜ assistant message ä¸Šçš„ `reasoning_content`ï¼Œå¹¶ä¸ `tool_calls` ç»„åˆå½¢æˆç¨³å®šçš„â€œæ€è€ƒâ€”å·¥å…·â€”ç»§ç»­æ€è€ƒâ€äº¤é”™é“¾è·¯ï¼ˆ`NeutralConversions` / `ChatCompletionService`ï¼‰ã€‚
- ğŸ§© **Response APIï¼ˆOpenAI / Azure AI Foundryï¼‰äº¤é”™æ€è€ƒå¢å¼º**ï¼šå½“å¯ç”¨ reasoning æ—¶ï¼Œè¯·æ±‚ä¸­è‡ªåŠ¨åŠ å…¥ `include: ["reasoning.encrypted_content"]`ï¼Œå¹¶åœ¨æµå¼å“åº”ä¸­æå– `response.output_item.done` çš„ `encrypted_content` å­˜å…¥ `ThinkChatSegment.Signature`ï¼›ä¸‹ä¸€æ¬¡è¯·æ±‚ä¼šå°†è¯¥ç­¾åä»¥ `{"type":"reasoning","encrypted_content":...}` å›ä¼ ï¼Œä»è€Œæ”¯æŒå¤šæ­¥å·¥å…·è°ƒç”¨çš„â€œæ€è€ƒâ€”å·¥å…·â€”æ€è€ƒâ€äº¤é”™é“¾è·¯ï¼ˆ`ResponseApiService` / `AzureResponseApiService`ï¼Œå•å…ƒæµ‹è¯•ï¼š`src/BE/tests/Chats.BE.UnitTest/ChatServices/Response/AzureResponseApiServiceTests.cs`ï¼‰ã€‚
  åŒæ—¶ï¼Œé€šè¿‡ `prompt_cache_key`ï¼ˆä»¥ end-user ä¸º keyï¼‰æå‡ç¼“å­˜å‘½ä¸­ç‡ã€‚

### 3) å‰ç«¯ä½“éªŒä¼˜åŒ–ï¼ˆå·¥å…·è°ƒç”¨ / ä¸Šä¼  / ä¿¡æ¯å¯†åº¦ï¼‰

- ğŸ§° **ToolCallBlock å…¨é¢ä¼˜åŒ–**ï¼šä¸º Code Interpreter å„å·¥å…·æä¾›æ›´æ¸…æ™°çš„å±•ç¤ºï¼ˆå‘½ä»¤æ‘˜è¦ã€sessionId/timeout å…ƒä¿¡æ¯ã€progress æµå¼è¾“å‡ºã€å¤åˆ¶æŒ‰é’®ã€è‡ªåŠ¨æŠ˜å ç­–ç•¥ã€é•¿è¾“å‡ºå±•ç¤ºä¼˜åŒ–ç­‰ï¼‰ï¼ˆ`src/FE/components/Markdown/ToolCallBlock.tsx`ï¼‰ã€‚
- ğŸ“ **ChatInput ä¸Šä¼ å¢å¼º**ï¼šæ”¯æŒæ‹–æ‹½ä¸Šä¼ ä¸ Ctrl+V ç²˜è´´ä¸Šä¼ ï¼›å¯¹ Code Interpreter åœºæ™¯å¯æ”¾å¼€â€œä»»æ„æ–‡ä»¶ç±»å‹â€ä¸Šä¼ ï¼›ç²˜è´´å›¾ç‰‡è‡ªåŠ¨ç”Ÿæˆæ›´åˆç†çš„æ–‡ä»¶åï¼ˆ`DragUpload` / `PasteUpload` / `ChatInput`ï¼‰ã€‚
- ğŸ–¼ï¸ **æ–‡ä»¶é¢„è§ˆä¸åˆ†äº«ä½“éªŒæ”¹è¿›**ï¼šæ–‡ä»¶åä¸å†è¢«æˆªæ–­ã€ç§»åŠ¨ç«¯é¢„è§ˆæ›´å‹å¥½ï¼›åˆ†äº«å¯¹è¯æ¡†æ”¯æŒå¤åˆ¶åˆ†äº«é“¾æ¥ç­‰ UI ä¼˜åŒ–ï¼ˆ`FilePreview` / `SharedMessageModal`ï¼‰ã€‚
- ğŸ“Š **ç”Ÿæˆä¿¡æ¯æ›´ç›´è§‚**ï¼šTurn ä¿¡æ¯æ°”æ³¡æ”¯æŒ step æ•°ã€å¹³å‡è€—æ—¶/å¹³å‡ TTFBï¼›å½“ step ä»… 1 ä¸ªæ—¶è‡ªåŠ¨éšè— step è®¡æ•°ï¼ˆ`TurnInfoBubble`ï¼‰ã€‚
- ğŸ—“ï¸ **ç®¡ç†åå°ä¼˜åŒ–**ï¼šä»ªè¡¨ç›˜æ—¥æœŸé€‰æ‹©å™¨æ–°å¢ today é«˜äº®ä¸å¿«æ·æŒ‰é’®ï¼ˆä»Šå¤©/æ˜¨å¤©/æœ¬å‘¨/æœ¬æœˆï¼‰ï¼Œä½¿ç”¨é‡é¡µé¢å¢åŠ åˆ·æ–°æŒ‰é’®ç­‰ã€‚

---

## ğŸ—ï¸ æ¶æ„ä¸å·¥ç¨‹

### 1) Code Interpreter é•œåƒæ„å»ºä¸å‘å¸ƒæµæ°´çº¿

- æ–°å¢ GitHub Actions å·¥ä½œæµ `code-interpreter.yml`ï¼šæ„å»ºå¹¶å‘å¸ƒå¤šæ¶æ„é•œåƒï¼ˆlinux/amd64 + linux/arm64ï¼‰ï¼Œå¹¶æ‰§è¡Œ smoke testï¼ˆ`.github/workflows/code-interpreter.yml`ï¼‰ã€‚
- é•œåƒæ„å»ºä¸Šä¸‹æ–‡ä¸æ¨¡æ¿ï¼š`Dockerfile`ã€NuGet æœ¬åœ°é¢„ç¼“å­˜ã€skills æ¸²æŸ“è„šæœ¬ç­‰ï¼ˆ`.github/workflows/code-interpreter/*`ï¼‰ã€‚

### 2) æ•°æ®åº“è¿ç§»ï¼ˆ1.10.0ï¼‰

- æ–°å¢ `ChatDockerSession` è¡¨ä¸ç´¢å¼•/å¤–é”®ï¼Œç”¨äºè®°å½•ä¸å›æ”¶ Docker ä¼šè¯ï¼ˆ`src/scripts/db-migration/1.10/1.10.0.sql`ï¼‰ã€‚
- å°†æ”¯æŒå·¥å…·è°ƒç”¨çš„æ¨¡å‹é»˜è®¤å¼€å¯ `AllowCodeExecution`ï¼ˆåŒä¸Šè¿ç§»è„šæœ¬ Step 2ï¼‰ã€‚

---

## ğŸ› ä¿®å¤ä¸ç¨³å®šæ€§æ”¹è¿›ï¼ˆèŠ‚é€‰ï¼‰

- ä¿®å¤ä¼šè¯è¿½è¸ªä¸ EF è·Ÿè¸ªç›¸å…³çš„å¼‚å¸¸é—®é¢˜ï¼Œé¿å…å‡ºç°â€œBalance/Step.Id è¢«é”™è¯¯ä¿®æ”¹â€çš„è¾¹ç¼˜æƒ…å†µã€‚
- ä¼˜åŒ– `create_docker_session` å¤±è´¥æç¤ºä¸ `EnsureSession` è¡Œä¸ºï¼ˆç”±æŠ›å¼‚å¸¸æ”¹ä¸º `Result<T>` è¿”å›ï¼‰ã€‚
- æ”¹è¿› `run_command`/è¯»å†™æ–‡ä»¶ç­‰å·¥å…·è¾“å‡ºçš„å±•ç¤ºç­–ç•¥ï¼šé•¿è¾“å‡ºä¸éç»“æ„åŒ–ç»“æœä¿¡æ¯æ›´ç´§å‡‘ï¼Œè¯»å†™ç»Ÿè®¡æŒ‰â€œè¡Œæ•°â€åé¦ˆæ›´è´´è¿‘æ¨¡å‹ç†è§£ã€‚

---

## â¬†ï¸ å‡çº§æç¤º

- è¿è¡Œæ•°æ®åº“è¿ç§»ï¼š`src/scripts/db-migration/1.10/1.10.0.sql`
- ç¡®ä¿éƒ¨ç½²ç¯å¢ƒå…·å¤‡ Docker èƒ½åŠ›ï¼Œå¹¶æŒ‰éœ€åœ¨ `src/BE/web/appsettings.json` é…ç½® `CodeInterpreter`ï¼ˆé»˜è®¤é•œåƒã€ç½‘ç»œæ¨¡å¼ã€èµ„æºé™åˆ¶ã€ä¸Šä¼ å¤§å°é™åˆ¶ç­‰ï¼‰
