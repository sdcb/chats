<!-- Language: zh-CN -->
<p><a href="./README.md">ğŸ“‹ æ‰€æœ‰ç‰ˆæœ¬</a> <span style="float:right"><a href="../../en-US/release-notes/1.9.0.md">English</a> | <b>ç®€ä½“ä¸­æ–‡</b></span></p>

# Chats 1.9.0 å‘å¸ƒè¯´æ˜

> å‘å¸ƒæ—¥æœŸï¼š2025-11-27ï¼ˆç›¸å¯¹ 1.8.1.279 ä»¥æ¥ 80 æ¬¡æäº¤ï¼‰

1.9.0 æ˜¯ä¸€æ¬¡é‡å¤§ç‰ˆæœ¬æ›´æ–°ï¼Œæ ¸å¿ƒäº®ç‚¹åŒ…æ‹¬**å…¨æ–°çš„ Anthropic æ¨¡å‹æä¾›å•†æ”¯æŒ**ã€**Anthropic Messages API å…¼å®¹æ¥å£**ã€**OpenAI å›¾åƒç”Ÿæˆ/ç¼–è¾‘ API**ã€**Build å¼€å‘è€…é¡µé¢**ä»¥åŠ**å…¨é¢çš„ç•Œé¢åŠ¨ç”»ä¼˜åŒ–**ã€‚æ­¤ç‰ˆæœ¬è¿˜å‡çº§åˆ° .NET 10ï¼Œé‡æ„äº† ChatService æ¶æ„ä»¥æ”¯æŒ Claude æ¨¡å‹çš„ thinking+signature æµç¨‹ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1) Anthropic æ¨¡å‹æä¾›å•†æ”¯æŒ

**æ–°å¢ Anthropic æä¾›å•†**ï¼ˆID=20ï¼‰ï¼š
- å®Œæ•´æ”¯æŒ Claude ç³»åˆ—æ¨¡å‹ï¼ˆåŒ…æ‹¬ claude-opus-4-5 ç­‰æœ€æ–°æ¨¡å‹ï¼‰
- ä½¿ç”¨åŸç”Ÿ HttpClient å®ç°ï¼Œç§»é™¤ Anthropic .NET SDK ä»¥è§£å†³å…¼å®¹æ€§é—®é¢˜
- æ”¯æŒ Claude ç‰¹æœ‰çš„ thinkingï¼ˆæ¨ç†ï¼‰+ signatureï¼ˆç­¾åï¼‰æµç¨‹
- é»˜è®¤ URLï¼š`https://api.anthropic.com`
- æ–°å¢ `anthropic.svg` å›¾æ ‡

**Anthropic æ¨¡å‹ç‰¹æ€§**ï¼š
- æ”¯æŒ `MaxThinkingBudget`ï¼ˆæ¨¡å‹çº§åˆ«ï¼‰å’Œ `ThinkingBudget`ï¼ˆä¼šè¯çº§åˆ«ï¼‰é…ç½®
- é»˜è®¤å¯ç”¨ Vision Link æ”¯æŒï¼ˆé€šè¿‡ URL ä¼ å›¾è€Œé base64ï¼‰
- æ”¯æŒå†…ç½® `web_search` å’Œ MCP å·¥å…·è°ƒç”¨
- æ”¯æŒ Claude æ¨¡å‹çš„ `signature` å­—æ®µå­˜å‚¨

**æ•°æ®åº“æ¶æ„è°ƒæ•´**ï¼š
- æ–°å¢ `StepContentThink` è¡¨ï¼ŒåŒ…å« `Content` å’Œ `Signature` å­—æ®µ
- å°†åŸæœ‰ reasoning æ•°æ®ä» `StepContentText` è¿ç§»åˆ° `StepContentThink`
- æ–°å¢ `Model.MaxThinkingBudget` åˆ—
- æ–°å¢ `ChatConfig.ThinkingBudget` åˆ—

**åç«¯é‡æ„**ï¼š
- `AnthropicChatService` ä½¿ç”¨åŸç”Ÿ HttpClient é‡æ–°å®ç°ï¼ˆ969 è¡Œï¼‰
- æ”¯æŒ `JsonPolymorphic` ç‰¹æ€§å¤„ç† Anthropic æµå¼äº‹ä»¶
- ChatService æ¶æ„æ”¹ä¸ºåŸºäº DB Steps é©±åŠ¨ï¼Œæ”¯æŒå¤šç§æ¶ˆæ¯æ ¼å¼è½¬æ¢

### 2) å¯¹å¤– API å¢å¼º

**Anthropic Messages API**ï¼ˆ/v1/messagesï¼‰ï¼š
- å®Œæ•´å…¼å®¹ Anthropic Messages API è§„èŒƒ
- æ”¯æŒæµå¼å’Œéæµå¼å“åº”
- æ”¯æŒ Tool Useï¼ˆå·¥å…·è°ƒç”¨ï¼‰
- æ”¯æŒ System Prompt è§£æ
- å®ç° Token è®¡æ•° APIï¼ˆ/v1/messages/count_tokensï¼‰

**æ ¸å¿ƒç»„ä»¶**ï¼ˆæ–°å¢ 6 ä¸ªæ–‡ä»¶ï¼‰ï¼š
- `AnthropicCompatibleController.cs`ï¼ˆ380 è¡Œï¼‰- API ç«¯ç‚¹æ§åˆ¶å™¨
- `AnthropicRequest.cs`ï¼ˆ140 è¡Œï¼‰- è¯·æ±‚ DTO
- `AnthropicResponse.cs`ï¼ˆ105 è¡Œï¼‰- å“åº” DTO
- `AnthropicStreamEvent.cs`ï¼ˆ227 è¡Œï¼‰- æµå¼äº‹ä»¶å®šä¹‰
- `AnthropicRequestWrapper.cs`ï¼ˆ307 è¡Œï¼‰- è¯·æ±‚è½¬æ¢å™¨
- `AnthropicSegmentExtensions.cs`ï¼ˆ112 è¡Œï¼‰- æ¶ˆæ¯æ®µæ‰©å±•

**OpenAI Image API**ï¼š
- å®ç°å›¾åƒç”Ÿæˆ APIï¼ˆPOST /v1/images/generationsï¼‰
- å®ç°å›¾åƒç¼–è¾‘ APIï¼ˆPOST /v1/images/editsï¼‰
- `OpenAIImageController.cs`ï¼ˆ478 è¡Œï¼‰- å®Œæ•´çš„å›¾åƒ API å®ç°
- `ImageGenerationDtos.cs`ï¼ˆ171 è¡Œï¼‰- å›¾åƒ API DTO å®šä¹‰

**API ç±»å‹å¼ºåˆ¶æ ¡éªŒ**ï¼š
- OpenAI å…¼å®¹æ¥å£å¼ºåˆ¶ä½¿ç”¨ `ChatCompletion` ç±»å‹æ¨¡å‹
- Anthropic å…¼å®¹æ¥å£å¼ºåˆ¶ä½¿ç”¨ `Anthropic` ç±»å‹æ¨¡å‹
- æ¥å£ä¸æ¨¡å‹ç±»å‹ä¸åŒ¹é…æ—¶è¿”å›æ˜ç¡®é”™è¯¯

### 3) Build å¼€å‘è€…é¡µé¢

**æ–°å¢ Build å¸ƒå±€å’Œé¡µé¢**ï¼ˆé¢å‘ API å¼€å‘è€…ï¼‰ï¼š
- `BuildLayout.tsx`ï¼ˆ201 è¡Œï¼‰- ç»Ÿä¸€çš„ Build é¡µé¢å¸ƒå±€
- ä¸‰ä¸ªæ ¸å¿ƒé¡µé¢ï¼šAPI Keysã€Docsã€Usage

**API Keys é¡µé¢**ï¼ˆ/build/api-keyï¼‰ï¼š
- API å¯†é’¥çš„åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ç®¡ç†
- å¯†é’¥æ©ç æ˜¾ç¤ºï¼ˆé˜²æ­¢æˆªå›¾æ³„éœ²æ•æ„Ÿä¿¡æ¯ï¼‰
- æ”¯æŒè®¾ç½®å¯†é’¥å¤‡æ³¨å’Œè¿‡æœŸæ—¶é—´
- æ˜¾ç¤ºæœ€åä½¿ç”¨æ—¶é—´
- ç‚¹å‡»å¯†é’¥å¯æŸ¥çœ‹è¯¥å¯†é’¥çš„ä½¿ç”¨è®°å½•
- å“åº”å¼å¸ƒå±€ï¼ˆç§»åŠ¨ç«¯å‹å¥½ï¼‰

**Docs é¡µé¢**ï¼ˆ/build/docsï¼‰ï¼š
- åˆ†ç±»å±•ç¤º OpenAI å…¼å®¹å’Œ Anthropic å…¼å®¹ API
- æ˜¾ç¤ºå®Œæ•´çš„ API URLï¼ˆå¯ä¸€é”®å¤åˆ¶ï¼‰
- é“¾æ¥åˆ°å®˜æ–¹æ–‡æ¡£
- OpenAI å…¼å®¹ APIï¼š
  - Chat Completionsï¼ˆ/v1/chat/completionsï¼‰
  - List Modelsï¼ˆ/v1/modelsï¼‰
  - Image Generationsï¼ˆ/v1/images/generationsï¼‰
  - Image Editï¼ˆ/v1/images/editsï¼‰
- Anthropic å…¼å®¹ APIï¼š
  - Messagesï¼ˆ/v1/messagesï¼‰
  - Count Tokensï¼ˆ/v1/messages/count_tokensï¼‰

**Usage é¡µé¢**ï¼ˆ/build/usageï¼‰ï¼š
- å¤ç”¨ç°æœ‰çš„ `UsageRecordsTab` ç»„ä»¶
- æ”¯æŒæŒ‰ API Key ç­›é€‰ä½¿ç”¨è®°å½•

### 4) ç•Œé¢ä¼˜åŒ–ä¸åŠ¨ç”»

**ChatInput åŠ¨ç”»ä¼˜åŒ–**ï¼š
- å±•å¼€/æ”¶èµ·æ—¶çš„å¹³æ»‘è¿‡æ¸¡åŠ¨ç”»
- å…¨å±åˆ‡æ¢åŠ¨ç”»æ•ˆæœ
- ä¿®å¤å‘é€æ¶ˆæ¯åé«˜åº¦æœªé‡ç½®çš„é—®é¢˜
- ä¿®å¤èŠå¤©æ—¶çš„é—ªçƒé—®é¢˜

**UserMenuPopover ç»„ä»¶ç»Ÿä¸€**ï¼š
- æå–ä¸ºç‹¬ç«‹ç»„ä»¶ï¼Œåœ¨èŠå¤©é¡µå’Œç®¡ç†é¡µå¤ç”¨
- æ·»åŠ ä¸‹æ‹‰èœå•åŠ¨ç”»æ•ˆæœ
- æ–°å¢ Tailwind åŠ¨ç”»é…ç½®

**ToolCallBlock ä¼˜åŒ–**ï¼š
- å¤´éƒ¨å±•å¼€/æ”¶èµ·æ·»åŠ åŠ¨ç”»è¿‡æ¸¡
- ä¿®å¤è‡ªåŠ¨å±•å¼€è¡Œä¸ºå¼‚å¸¸çš„é—®é¢˜
- ä¼˜åŒ–ç™½è‰²ä¸»é¢˜ä¸‹çš„è§†è§‰æ•ˆæœ
- ä¼˜åŒ– Anthropic å†…ç½® `web_search` å·¥å…·çš„å‰ç«¯æ¸²æŸ“

**å…¶ä»– UI æ”¹è¿›**ï¼š
- ä¿®å¤ UserMessage ä¸‹çš„äºšåƒç´ çº¿æ¡é—®é¢˜
- ä¼˜åŒ–ç®¡ç†é¡µé¢çš„ç§»åŠ¨ç«¯å¸ƒå±€
- ä¼˜åŒ–æ¨¡å‹ç®¡ç†é¡µé¢æ ‡ç­¾å’Œæè¿° UI
- åˆ é™¤èŠå¤©ç¡®è®¤æ—¶æ·»åŠ åŠ è½½æŒ‡ç¤ºå™¨
- èŠå¤©ç¼“å­˜ä¸åˆ›å»º/åˆ é™¤æ“ä½œä¿æŒåŒæ­¥

---

## ğŸ—ï¸ æ¶æ„æ”¹è¿›

### 1) å‡çº§åˆ° .NET 10

- æ¡†æ¶ä» .NET 9 å‡çº§åˆ° .NET 10
- æ›´æ–°æ‰€æœ‰ç›¸å…³ NuGet åŒ…
- OpenAI SDK å‡çº§åˆ° 2.7.0
- æ„å»ºæµç¨‹åˆ‡æ¢åˆ° Ubuntu 24.04

### 2) ChatService æ¶æ„é‡æ„

**æ ¸å¿ƒå˜æ›´**ï¼š
- ChatService ä»åŸºäº OpenAI payload é©±åŠ¨æ”¹ä¸ºåŸºäº DB Steps é©±åŠ¨
- æ–°å¢ `ChatServiceRequest` ç±»å°è£…è¯·æ±‚æ•°æ®
- æ”¯æŒ Anthropic çš„ thinking+signature æµç¨‹
- ChatService æ”¹ä¸º DI å•ä¾‹æ³¨å†ŒæœåŠ¡
- ChatService ä¸å†ç»§æ‰¿ `IDisposable`

**ä»£ç ä¼˜åŒ–**ï¼š
- åˆ é™¤ `ChatServiceExtensions.cs`ï¼ˆ136 è¡Œï¼‰
- åˆ é™¤ `TestChatService.cs`ï¼ˆ76 è¡Œï¼‰
- ç®€åŒ–å„ä¸ª ChatService å®ç°
- ç»Ÿä¸€çš„è¯·æ±‚/å“åº”å¤„ç†æµç¨‹

### 3) æ–°å¢ Model.SupportsVisionLink å­—æ®µ

- æ§åˆ¶å›¾ç‰‡ä¼ è¾“æ–¹å¼ï¼šURL é“¾æ¥æˆ– Base64 ç¼–ç 
- Anthropic æ¨¡å‹é»˜è®¤å¯ç”¨ï¼ˆä½¿ç”¨ URLï¼‰
- å…¶ä»–æ¨¡å‹é»˜è®¤ç¦ç”¨ï¼ˆä½¿ç”¨ Base64ï¼Œå…¼å®¹æ€§æ›´å¥½ï¼‰
- å¯åœ¨æ¨¡å‹é…ç½®ä¸­æ‰‹åŠ¨åˆ‡æ¢

---

## ğŸ› é—®é¢˜ä¿®å¤

### 1) Thinking Budget ä¿®å¤
- ä¿®å¤æ— æ³•åº”ç”¨ thinking budget è®¾ç½®çš„é—®é¢˜
- æ­£ç¡®ä¼ é€’æ¨¡å‹çº§åˆ«å’Œä¼šè¯çº§åˆ«çš„ budget é…ç½®

### 2) Gemini ç›¸å…³ä¿®å¤
- ä¿®å¤å¯ç”¨ thinking åæ— æ³•æ­£å¸¸å¯¹è¯çš„é—®é¢˜
- ç¦ç”¨ Google Gemini è‡ªåŠ¨é‡è¯•ä»¥ç»•è¿‡ä¸Šæ¸¸ bugï¼ˆmscraftsman/generative-ai#144ï¼‰

### 3) UI ç›¸å…³ä¿®å¤
- ä¿®å¤ ChatInput å‘é€æ¶ˆæ¯åé«˜åº¦æœªé‡ç½®çš„é—®é¢˜
- ä¿®å¤ UserMessage ä¸‹çš„äºšåƒç´ çº¿æ¡æ˜¾ç¤ºé—®é¢˜
- ä¿®å¤ ToolCallBlock è‡ªåŠ¨å±•å¼€è¡Œä¸ºå¼‚å¸¸
- ä¿®å¤éå…¨å±æ¨¡å¼ä¸‹ FilePreview ç¼ºå¤±çš„é—®é¢˜
- ä¿®å¤ Quick Add Model å›  VisionLink å˜æ›´å¯¼è‡´çš„å¤±è´¥
- ä¿®å¤ç®¡ç†æ¨¡å‹é¡µ"æ˜¾ç¤ºæ‰€æœ‰æä¾›å•†"æŒ‰é’®ä¸å·¥ä½œçš„é—®é¢˜

### 4) API ç›¸å…³ä¿®å¤
- ä¿®å¤ Anthropic Messages API çš„ tool call finish reason å¤„ç†
- ä¿®å¤ Anthropic Messages API çš„ system prompt è§£æï¼ˆæ”¯æŒ Claude Codeï¼‰
- ä¿®å¤åˆ‡æ¢ ApiType æ—¶å½±å“æ¨¡å‹ä»·æ ¼çš„é—®é¢˜

---

## ğŸ—„ï¸ æ•°æ®åº“è¿ç§»

**è¿ç§»è„šæœ¬ä½ç½®**ï¼š
```
src/scripts/db-migration/1.9/1.9.0.sql
```

### è¿ç§»å†…å®¹

**Step 1ï¼šåˆ›å»º StepContentThink è¡¨**
```sql
CREATE TABLE dbo.StepContentThink (
    Id BIGINT NOT NULL,
    Content NVARCHAR(MAX) NOT NULL,
    Signature VARBINARY(MAX) NULL,
    CONSTRAINT PK_StepContentThink PRIMARY KEY CLUSTERED (Id),
    CONSTRAINT FK_StepContentThink_StepContent FOREIGN KEY (Id) REFERENCES dbo.StepContent (Id)
);
```

**Step 2ï¼šè¿ç§» reasoning æ•°æ®**
- å°† `ContentTypeId = 3` çš„è®°å½•ä» `StepContentText` è¿ç§»åˆ° `StepContentThink`

**Step 3ï¼šç§»é™¤ StepContentType è¡¨**
- åˆ é™¤å¤–é”®çº¦æŸå’Œè¡¨æœ¬èº«

**Step 4ï¼šFile.MediaType æ”¹é€ **
- æ–°å¢ `File.MediaType` åˆ—
- è¿ç§» `FileContentType` æ•°æ®
- åˆ é™¤ `FileContentType` è¡¨

**Step 5ï¼šStepContentBlob å¢å¼º**
- æ–°å¢ `MediaType` å’Œ `FileName` åˆ—

**Step 6ï¼šç§»é™¤ ChatRole è¡¨**
- åˆ é™¤ `Step` è¡¨çš„å¤–é”®çº¦æŸ
- åˆ é™¤ `ChatRole` è¡¨

**Step 7ï¼šModel/ChatConfig è¡¨è°ƒæ•´**
- åˆ é™¤ `Model.AllowSystemPrompt` åˆ—
- æ–°å¢ `Model.MaxThinkingBudget` åˆ—
- æ–°å¢ `ChatConfig.ThinkingBudget` åˆ—
- è°ƒæ•´ `ReasoningEffortOptions` å’Œ `SupportedImageSizes` ä¸ºå¯ç©º

**Step 8ï¼šå­—æ®µé‡å‘½å**
- `ChatConfig.ReasoningEffort` â†’ `ChatConfig.ReasoningEffortId`
- `Model.ApiType` â†’ `Model.ApiTypeId`

**Step 9ï¼šæ–°å¢ Model.SupportsVisionLink**
- æ·»åŠ å¸ƒå°”å­—æ®µï¼Œé»˜è®¤ä¸º false

### è¿ç§»æ­¥éª¤

1. **å¤‡ä»½æ•°æ®åº“**ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰
2. **åœæ­¢åº”ç”¨æœåŠ¡**
3. **æ‰§è¡Œè¿ç§»è„šæœ¬**ï¼š
   ```bash
   sqlcmd -S localhost -d Chats -i 1.9.0.sql
   ```
4. **éªŒè¯è¿ç§»ç»“æœ**
5. **æ›´æ–°åº”ç”¨ç¨‹åº**
6. **å¯åŠ¨æœåŠ¡**

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

### æ•´ä½“å˜æ›´

- **æäº¤æ•°é‡**ï¼š80 æ¬¡æäº¤
- **ä¸»è¦å˜æ›´**ï¼šAnthropic æ”¯æŒã€API å¢å¼ºã€Build é¡µé¢ã€åŠ¨ç”»ä¼˜åŒ–ã€.NET 10 å‡çº§

### å…³é”®æ¨¡å—

**åç«¯æ–°å¢**ï¼š
- `AnthropicChatService.cs` - 969 è¡Œï¼ˆAnthropic èŠå¤©æœåŠ¡ï¼‰
- `AnthropicCompatibleController.cs` - 380 è¡Œï¼ˆAnthropic API æ§åˆ¶å™¨ï¼‰
- `AnthropicRequestWrapper.cs` - 307 è¡Œï¼ˆè¯·æ±‚è½¬æ¢ï¼‰
- `AnthropicStreamEvent.cs` - 227 è¡Œï¼ˆæµå¼äº‹ä»¶ï¼‰
- `OpenAIImageController.cs` - 478 è¡Œï¼ˆå›¾åƒ APIï¼‰
- `ChatServiceRequest.cs` - 115 è¡Œï¼ˆè¯·æ±‚å°è£…ï¼‰

**å‰ç«¯æ–°å¢**ï¼š
- `BuildLayout.tsx` - 201 è¡Œï¼ˆBuild å¸ƒå±€ï¼‰
- `BuildApiKeyPage` - 255 è¡Œï¼ˆAPI Key ç®¡ç†ï¼‰
- `BuildDocsPage` - 120 è¡Œï¼ˆAPI æ–‡æ¡£ï¼‰
- `UserMenuPopover.tsx` - 110 è¡Œï¼ˆç”¨æˆ·èœå•ç»„ä»¶ï¼‰

**æ•°æ®åº“è¿ç§»**ï¼š
- `1.9.0.sql` - 421 è¡Œï¼ˆå®Œæ•´è¿ç§»è„šæœ¬ï¼‰

---

## ğŸš€ å‡çº§æŒ‡å—

### ä» 1.8.1 å‡çº§åˆ° 1.9.0

1. **å¤‡ä»½æ•°æ®åº“**ï¼ˆå¼ºçƒˆå»ºè®®ï¼Œæ­¤ç‰ˆæœ¬æœ‰é‡å¤§æ¶æ„å˜æ›´ï¼‰
2. **åœæ­¢åº”ç”¨æœåŠ¡**
3. **æ‰§è¡Œæ•°æ®åº“è¿ç§»**ï¼š
   ```bash
   sqlcmd -S localhost -d Chats -i 1.9.0.sql
   ```
4. **æ›´æ–° .NET è¿è¡Œæ—¶åˆ° 10.0**
5. **æ›´æ–°åç«¯ä»£ç **
6. **æ›´æ–°å‰ç«¯ä»£ç **
7. **å¯åŠ¨åº”ç”¨æœåŠ¡**
8. **éªŒè¯åŠŸèƒ½**ï¼š
   - æµ‹è¯• Anthropic æ¨¡å‹æ˜¯å¦æ­£å¸¸å·¥ä½œ
   - æµ‹è¯• Build é¡µé¢åŠŸèƒ½
   - æµ‹è¯• Anthropic Messages API
   - æµ‹è¯•å›¾åƒç”Ÿæˆ API
   - éªŒè¯ç°æœ‰èŠå¤©è®°å½•çš„ thinking å†…å®¹æ˜¾ç¤º

### æ–°åŠŸèƒ½ä½¿ç”¨è¯´æ˜

**æ·»åŠ  Anthropic æ¨¡å‹**ï¼š
1. è¿›å…¥æ¨¡å‹ç®¡ç†é¡µé¢
2. é€‰æ‹© Anthropic æä¾›å•†
3. å¡«å†™ API Keyï¼ˆä» Anthropic Console è·å–ï¼‰
4. æ·»åŠ æ¨¡å‹ï¼ˆå¦‚ claude-sonnet-4-5-20250514ï¼‰
5. å¯é€‰é…ç½® MaxThinkingBudget

**ä½¿ç”¨ Build é¡µé¢**ï¼š
1. ç‚¹å‡»ç”¨æˆ·èœå•ä¸­çš„"Build"é€‰é¡¹
2. åœ¨ API Keys é¡µé¢åˆ›å»ºæ–°çš„ API Key
3. åœ¨ Docs é¡µé¢æŸ¥çœ‹æ”¯æŒçš„ API ç«¯ç‚¹
4. åœ¨ Usage é¡µé¢æŸ¥çœ‹ä½¿ç”¨è®°å½•

**è°ƒç”¨ Anthropic Messages API**ï¼š
```bash
curl -X POST https://your-chats-url/v1/messages \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -H "anthropic-version: 2023-06-01" \
  -d '{
    "model": "claude-sonnet-4-5-20250514",
    "max_tokens": 1024,
    "messages": [{"role": "user", "content": "Hello!"}]
  }'
```

---

## âš ï¸ ç ´åæ€§å˜æ›´

### 1. .NET ç‰ˆæœ¬å‡çº§

- è¿è¡Œæ—¶è¦æ±‚ä» .NET 9 å‡çº§åˆ° .NET 10
- éƒ¨ç½²ç¯å¢ƒéœ€è¦å®‰è£… .NET 10 è¿è¡Œæ—¶

### 2. æ•°æ®åº“æ¶æ„å˜æ›´

**åˆ é™¤çš„è¡¨**ï¼š
- `StepContentType`
- `FileContentType`
- `ChatRole`

**å­—æ®µé‡å‘½å**ï¼š
- `Model.ApiType` â†’ `Model.ApiTypeId`
- `ChatConfig.ReasoningEffort` â†’ `ChatConfig.ReasoningEffortId`

**åˆ é™¤çš„å­—æ®µ**ï¼š
- `Model.AllowSystemPrompt`

### 3. ChatService æ¥å£å˜æ›´

- ChatService ä¸å†ç»§æ‰¿ `IDisposable`
- æ„é€ å‡½æ•°ç­¾åå¯èƒ½æœ‰å˜åŒ–
- å¦‚æœ‰è‡ªå®šä¹‰ ChatService å®ç°éœ€è¦é€‚é…æ–°æ¶æ„

---

## ğŸ“ å·²çŸ¥é™åˆ¶

- Anthropic æœåŠ¡æš‚ä¸æ”¯æŒ prompt caching åŠŸèƒ½ï¼Œå¯èƒ½å½±å“é•¿å¯¹è¯çš„æˆæœ¬ä¼˜åŒ–

---

## ğŸ“ å­¦ä¹ èµ„æº

### ç›¸å…³æ–‡æ¡£

- ğŸ“– [1.8.1 å‘å¸ƒè¯´æ˜](./1.8.1.md) - äº†è§£ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„æ›´æ–°
- ğŸ“– [Anthropic API æ–‡æ¡£](https://docs.anthropic.com/en/api/messages) - å®˜æ–¹ Messages API å‚è€ƒ
- ğŸ“– [OpenAI Images API æ–‡æ¡£](https://platform.openai.com/docs/api-reference/images) - å®˜æ–¹å›¾åƒ API å‚è€ƒ

### ç¤¾åŒºæ”¯æŒ

- ğŸ› [æŠ¥å‘Šé—®é¢˜](https://github.com/sdcb/chats/issues)
- ğŸ’¬ [å‚ä¸è®¨è®º](https://github.com/sdcb/chats/discussions)
- ğŸ“§ è”ç³»ä½œè€…ï¼š[https://github.com/sdcb](https://github.com/sdcb)

---

## ğŸ™ è´¡çŒ®è€…

æ„Ÿè°¢æ‰€æœ‰ä¸ºæœ¬ç‰ˆæœ¬åšå‡ºè´¡çŒ®çš„å¼€å‘è€…ï¼

ç‰¹åˆ«æ„Ÿè°¢ï¼š
- [@sdcb](https://github.com/sdcb) - Anthropic æä¾›å•†æ”¯æŒã€Messages APIã€å›¾åƒ APIã€Build é¡µé¢ã€ç•Œé¢åŠ¨ç”»ã€.NET 10 å‡çº§ã€æ•°æ®åº“æ¶æ„é‡æ„

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ [GitHub Issues](https://github.com/sdcb/chats/issues) åé¦ˆã€‚

---

## ğŸ“ æ›´æ–°æ—¥å¿—æ‘˜è¦

### æ–°å¢åŠŸèƒ½

- âœ… Anthropic æ¨¡å‹æä¾›å•†æ”¯æŒï¼ˆID=20ï¼‰
- âœ… Anthropic Messages API å…¼å®¹æ¥å£ï¼ˆ/v1/messagesï¼‰
- âœ… Anthropic Token è®¡æ•° APIï¼ˆ/v1/messages/count_tokensï¼‰
- âœ… OpenAI å›¾åƒç”Ÿæˆ APIï¼ˆ/v1/images/generationsï¼‰
- âœ… OpenAI å›¾åƒç¼–è¾‘ APIï¼ˆ/v1/images/editsï¼‰
- âœ… Build å¼€å‘è€…é¡µé¢ï¼ˆAPI Keys / Docs / Usageï¼‰
- âœ… API å¯†é’¥æ©ç æ˜¾ç¤º
- âœ… ChatInput å±•å¼€/æ”¶èµ·/å…¨å±åŠ¨ç”»
- âœ… UserMenuPopover åŠ¨ç”»æ•ˆæœ
- âœ… ToolCallBlock å¤´éƒ¨åŠ¨ç”»
- âœ… Model.SupportsVisionLink å­—æ®µ

### æ¶æ„æ”¹è¿›

- âœ… å‡çº§åˆ° .NET 10
- âœ… ChatService æ¶æ„é‡æ„ï¼ˆåŸºäº DB Steps é©±åŠ¨ï¼‰
- âœ… æ–°å¢ StepContentThink è¡¨æ”¯æŒ Claude signature
- âœ… ChatService æ”¹ä¸º DI å•ä¾‹æ³¨å†Œ
- âœ… ç»Ÿä¸€çš„ UserMenuPopover ç»„ä»¶

### é—®é¢˜ä¿®å¤

- âœ… ä¿®å¤ thinking budget æ— æ³•åº”ç”¨çš„é—®é¢˜
- âœ… ä¿®å¤ Gemini å¯ç”¨ thinking åæ— æ³•å¯¹è¯çš„é—®é¢˜
- âœ… ä¿®å¤ ChatInput é«˜åº¦é‡ç½®é—®é¢˜
- âœ… ä¿®å¤ UserMessage äºšåƒç´ çº¿æ¡é—®é¢˜
- âœ… ä¿®å¤ ToolCallBlock è‡ªåŠ¨å±•å¼€å¼‚å¸¸
- âœ… ä¿®å¤ FilePreview åœ¨éå…¨å±æ¨¡å¼ç¼ºå¤±
- âœ… ä¿®å¤ Anthropic API tool call finish reason
- âœ… ç¦ç”¨ Google Gemini é‡è¯•ä»¥ç»•è¿‡ä¸Šæ¸¸ bug

### æ•°æ®åº“è¿ç§»

- âœ… åˆ›å»º StepContentThink è¡¨ï¼ˆå« Signature å­—æ®µï¼‰
- âœ… è¿ç§» reasoning æ•°æ®
- âœ… ç§»é™¤ StepContentType/FileContentType/ChatRole è¡¨
- âœ… æ·»åŠ  Model.MaxThinkingBudget å­—æ®µ
- âœ… æ·»åŠ  ChatConfig.ThinkingBudget å­—æ®µ
- âœ… æ·»åŠ  Model.SupportsVisionLink å­—æ®µ
- âœ… å­—æ®µé‡å‘½åï¼ˆApiTypeâ†’ApiTypeId, ReasoningEffortâ†’ReasoningEffortIdï¼‰

### ä»£ç æ¸…ç†

- âœ… åˆ é™¤ ChatServiceExtensions.cs
- âœ… åˆ é™¤ TestChatService.cs
- âœ… ç§»é™¤ Anthropic .NET SDK ä¾èµ–
- âœ… ç®€åŒ– ChatService å®ç°

---

<p align="center">
  <sub>æœ€åæ›´æ–°ï¼š2025-11-27</sub>
</p>
