<!-- Language: zh-CN -->
<p><a href="./README.md">📋 所有版本</a> <span style="float:right"><a href="../../en-US/release-notes/1.1.md">English</a> | <b>简体中文</b></span></p>

# Chats 1.1 发布说明

> 发布日期：2025-04-24（相对 1.0.2 以来 8 次提交）

1.1.0 是一次重要的模型支持升级版本，核心聚焦于 Azure OpenAI 推理模型（Reasoning Models）的支持，通过集成全新的 Response API 实现了 o3/o4-mini 等推理模型的推理摘要（reasoning summary）功能，并同步升级了 OpenAI 和 Azure OpenAI SDK 至最新版本。

## 亮点概览

- **Azure OpenAI 推理模型支持**：新增 Response API 集成，支持 o3/o4-mini 等模型的推理摘要功能
- **SDK 全面升级**：OpenAI .NET SDK 升级至 2.2.0-beta.4，Azure OpenAI SDK 升级至 2.2.0-beta.4
- **推理内容优化**：改进推理过程（thinking）的格式，使用双换行符分隔以提升可读性
- **默认提示词优化**：改进系统默认提示词，提升对话质量
- **镜像上传优化**：同步上传到 Minio，加快中国用户的访问速度

---

## 新功能与改进详情

### 1) Azure OpenAI Response API 支持

新增 `AzureResponseApiService` 服务类（289 行新增代码）：
- 实现 Azure OpenAI 的 Response API 调用
- 支持推理模型（o3/o4-mini 等）的推理摘要功能
- 推理内容自动提取并以结构化方式呈现
- 与现有聊天服务无缝集成

核心特性：
- 支持推理模型的特殊响应格式
- 自动识别并处理推理内容（reasoning content）
- 与标准聊天 API 保持一致的接口设计
- 适配 Azure OpenAI 的最新 API 规范

限制说明：
- Response API 不支持在助手消息中包含图片内容部分
- 该限制已在代码中进行相应处理和注释

### 2) SDK 升级

**OpenAI .NET SDK**：
- 从 2.1.0 升级至 2.2.0-beta.4
- 支持最新的 API 特性和改进
- 更好的性能和稳定性

**Azure.AI.OpenAI SDK**：
- 从 2.1.0 升级至 2.2.0-beta.4
- 新增 Response API 支持
- 与最新的 Azure OpenAI 服务功能保持同步

### 3) 推理内容格式优化

推理过程展示改进：
- 推理内容块之间使用双换行符（`\n\n`）分隔
- 提升推理过程的可读性和清晰度
- 更好的视觉层次感
- 优化前端展示效果

相关变更：
- `ReasoningContentFactory` 中调整分隔符逻辑
- `ChatSegment` DTO 优化推理内容处理

### 4) 默认提示词优化

系统默认提示词改进：
- 优化 `PromptsController` 中的默认提示逻辑
- 改进 `ModelReference` 扩展方法
- 优化 `InitService` 中的初始化提示配置
- 提升对话的默认质量和用户体验

### 5) 部署与分发优化

镜像上传改进：
- 同步上传至 Minio 对象存储
- 为中国用户提供更快的访问速度
- 镜像下载链接更新（见 GitHub Release）

Docker 镜像支持：
- Linux x64/ARM64
- Windows Nano Server（1809/LTSC 2022/LTSC 2025）
- macOS x64/ARM64

### 6) 测试与质量改进

单元测试完善：
- 修复 `MaskedKeyUtilsTest` 测试用例
- 确保 SDK 升级后的兼容性
- 代码质量持续保障

---

## 技术细节

### Response API vs Chat Completions API

Response API 是 Azure OpenAI 针对推理模型推出的新 API：
- 专为 o3、o4-mini 等推理模型设计
- 提供推理摘要（reasoning summary）功能
- 返回模型的推理过程和最终答案
- 与标准 Chat Completions API 互补

### 推理模型适配

推理模型特性：
- 模型在生成答案前会进行深度推理
- 推理过程可选择性地暴露给用户
- 推理摘要帮助用户理解模型的思考过程
- 提升复杂问题的回答质量

### 服务架构优化

`ChatFactory` 改进：
- 新增 Response API 服务创建逻辑
- 根据模型类型自动选择合适的服务
- 保持向后兼容性
- 统一的服务接口设计

---

## 升级说明

### 兼容性

- **数据库**：无需迁移，完全兼容 1.0.x 版本
- **配置文件**：无需修改，向后兼容
- **API 接口**：保持一致，无破坏性变更

### 推荐升级步骤

1. 备份现有部署（可选但推荐）
2. 停止当前服务
3. 使用新版本镜像或二进制文件替换
4. 启动服务
5. 验证推理模型功能（如果使用 Azure OpenAI o3/o4-mini）

### Azure OpenAI 推理模型使用

要使用推理摘要功能：
1. 确保你的 Azure OpenAI 订阅支持 o3 或 o4-mini 模型
2. 在模型配置中添加相应的推理模型
3. 创建聊天时选择推理模型
4. 系统将自动使用 Response API 获取推理摘要

---

## 已知问题

- Response API 不支持在助手消息中包含图片内容
  - 影响范围：使用推理模型进行多模态对话时
  - 解决方案：系统已自动处理该限制

---

## 相关链接

- **完整变更日志**：https://github.com/sdcb/chats/compare/1.0.2.762...1.1.0.774
- **GitHub Release**：https://github.com/sdcb/chats/releases/tag/1.1.0.774
- **Docker Hub**：https://hub.docker.com/r/sdcb/chats

---

## 致谢

感谢所有使用 Chats 的用户，你们的反馈帮助我们不断改进产品。

如有问题或建议，欢迎在 GitHub 上提 Issue 或 Discussion。
