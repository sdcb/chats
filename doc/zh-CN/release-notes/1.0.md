<!-- Language: zh-CN -->
<p align="right"><a href="../../en-US/release-notes/1.0.md">English</a> | <b>简体中文</b></p>

# Chats 1.0 发布说明（正式版）

> 发布日期：2025-04-21（包含 1.0.0/1.0.1/1.0.2 三个小版本）

Chats 1.0 是一个里程碑式的正式版本，标志着项目从 0.x 预览版进入生产就绪阶段。本次更新在功能完善性、稳定性、用户体验等方面进行了全面提升，引入了全新的用户设置页面、使用报表统计、管理员消费汇总等重要功能，同时大幅扩展了模型支持，优化了前后端性能与交互体验。

## 版本说明

- **1.0.0**（756）：正式版发布，核心功能完善
- **1.0.1**（759）：修复推理级别导致无法聊天的问题，修复 CI/CD 变更日志缺失问题
- **1.0.2**（762）：修复 Google Gemini 推理级别问题和非思考模型问题

---

## 亮点概览

- **版本号策略调整**：采用语义化版本号（Semantic Versioning），正式版本从 1.0.0 开始
- **全新用户设置页面**：用户可集中管理个人相关配置，操作更直观便捷
- **使用报表及统计页面**：详细记录每一笔请求与消费（API 与 Web 端），支持导出 Excel
- **多模型接入与扩展**：新增 GPT-4.1 系列、o3/o4-mini、豆包 1.5 系列、Gemini 2.5 Flash 等模型
- **思考超时大幅提升**：模型思考超时从 100 秒延长至 24 小时，保证完整输出
- **后台持续输出**：关闭窗口后模型继续生成，刷新页面即可看到最新内容
- **管理员消费汇总**：新增消费汇总页面，支持多条件过滤与统计，可导出 Excel
- **前端全面优化**：响应速度、视觉体验、交互逻辑全面提升
- **数据库架构完善**：新增模型配置、定价调整、性能优化

---

## 新功能与改进详情

### 1) 版本号策略调整

采用语义化版本号（Semantic Versioning）规范：
- **主版本号（MAJOR）**：破坏性变更或重大功能更新
- **次版本号（MINOR）**：向后兼容的功能新增
- **修订号（PATCH）**：向后兼容的问题修复
- 正式版本从 `1.0.0` 开始，告别 0.x 预览版
- CI/CD 流程优化：改进版本号生成逻辑，修复变更日志生成问题

### 2) 全新用户设置页面

推出专门的用户设置页面：
- 集中管理个人配置信息
- 直观的用户界面设计
- 便捷的操作流程
- 支持个性化设置保存

### 3) 使用报表及统计功能

全新的使用统计与报表系统：
- **后端 API**：
  - 新增 `StatisticsController`：提供详细的用量统计接口
  - 支持 API 与 Web 端数据的统一记录
  - 用量统计 API（`UsageStatController`）提供数据查询能力
  - 修复用量时间查询问题，确保数据准确性
  
- **前端功能**：
  - 新增使用统计页面（`usage-stat`），展示详细的请求与消费记录
  - 支持按用户、模型、时间等维度筛选
  - 一键导出为 Excel 文件，便于数据归档与分析
  - 整合原有的 7 天使用记录，统一展示所有统计数据
  - 优化提示标签页（`prompt tab`）展示

- **数据优化**：
  - 避免在统计响应中包含键值（KV）模型
  - 修复 EF 日期转换问题
  - 修复除零错误（`div 0 issue`）
  - 修复 `toFixed` 数值精度问题

### 4) 多模型接入与扩展（需要数据库迁移）

大幅扩展模型支持，新增多个主流 AI 模型：

**OpenAI 系列**：
- **GPT-4.1 系列**（`gpt-4.1`、`gpt-4.1-mini`、`gpt-4.1-nano`）
  - 上下文窗口：1,047,576 tokens
  - 最大响应：32,768 tokens
  - 发布日期：2025-04-14
  - 支持流式、视觉、系统提示
  - 定价（OpenAI/Azure/GitHub Models）：
    - `gpt-4.1`：输入 $2/1M tokens，输出 $8/1M tokens
    - `gpt-4.1-mini`：输入 $0.4/1M tokens，输出 $1.6/1M tokens
    - `gpt-4.1-nano`：输入 $0.1/1M tokens，输出 $0.4/1M tokens

- **推理模型系列**（`o3`、`o4-mini`）
  - 上下文窗口：200,000 tokens
  - 最大响应：100,000 tokens
  - 发布日期：2025-04-16
  - 支持流式、视觉、系统提示
  - 定价（OpenAI/Azure/GitHub Models）：
    - `o3`：输入 $10/1M tokens，输出 $40/1M tokens
    - `o4-mini`：输入 $1.1/1M tokens，输出 $4.4/1M tokens

**豆包系列**（Doubao 1.5）：
- `doubao-1.5-thinking-pro-250415`（思考增强版）
- `doubao-1.5-thinking-pro-vision-250415`（思考+视觉增强版）
- `doubao-1.5-vision-pro-250328`（视觉增强版）
- `doubao-1.5-vision-lite-250315`（视觉轻量版）
- `doubao-1.5-ui-tars-250328`（UI 专用版）
- 上下文窗口：131,072 tokens（UI 版为 32,768 tokens）
- 最大响应：16,384 tokens（UI 版为 4,096 tokens）
- 支持推理响应、流式、系统提示
- 定价（人民币）：¥1.5-4/1M tokens（输入），¥4.5-16/1M tokens（输出）

**Google Gemini**：
- `gemini-2.5-flash-preview-04-17`
- 上下文窗口：1,048,576 tokens
- 最大响应：65,536 tokens
- 发布日期：2025-04-17
- 支持推理响应、流式、搜索、视觉、系统提示
- 定价：输入 $0.15/1M tokens，输出 $3.5/1M tokens
- 升级依赖包，Gemini 支持推理级别（reasoning effort）

**xAI Grok**：
- 将 Grok 短名称更新为 `grok-3`

数据库迁移脚本：`src/scripts/db-migration/1.6/20250415-openai-gpt41.sql`

### 5) 模型思考超时大幅提升

显著改进模型响应超时机制：
- 将模型思考超时时间从 **100 秒延长至 24 小时**
- 确保大模型在必要时段内能够输出完整结果
- 特别优化网络超时配置：
  - Google Gemini：24 小时网络超时
  - Azure OpenAI：遵循 1 小时网络超时
- 为聊天禁用取消令牌（cancellation token），避免意外中断
- 前端保留"停止生成"按钮，用户可主动终止生成过程

### 6) 后台持续输出功能

提供更灵活的生成体验：
- 当模型在后台思考或生成输出时，用户可随时关闭当前窗口
- 下次刷新页面后自动显示最新生成内容
- 无需担心数据丢失或生成中断
- 修复响应速度问题（`response speed issues`）

### 7) 管理员消费汇总页面

为管理员提供强大的数据监控能力：
- **新增管理员用量页面**（`admin usage page`）
  - 支持多条件过滤与统计
  - 提供 Excel 导出功能
  - 便于对全局使用情况进行监控和管理
- **非管理员用户访问权限**：允许非管理员用户访问自己的用量统计页面
- **数据查询优化**：修复用量查询 API 的 Prompt 500 错误（当 `kid` 为 null 时）

### 8) 用户界面与体验优化

前端进行了大量优化改进：

**显示与格式化**：
- 添加余额显示（`balance display`）
- 优化日期格式展示，修复 URL 问题
- 添加导出 Excel 功能并格式化日期
- 标签分组展示（`show tags as groups`）

**分页与导航**：
- 新增分页数字显示（`pagination number`）
- 修复模态对话框显示问题（`modal display issues`）
- 页面发送多次请求优化
- 将用量页面移至标签页（`move usage page to tab`）

**API 与会话**：
- 支持 URL 中的会话参数（`session in url`）
- 修复共享消息显示问题（`shared message display issues`）
- 导出文件方法改为 GET 请求

**样式与响应**：
- 设置 401 状态不显示消息提示
- 各组件响应速度显著提升
- 视觉体验全面改进

### 9) 国际化支持

- 更新翻译钩子（`useTranslation hooks`）
- 优化多语言支持

### 10) 数据库迁移与架构优化

完善数据库结构与配置：
- **模型配置更新**：通过 MERGE 语句批量插入/更新模型引用数据
- **定价调整**：更新各模型的输入/输出 token 定价
- **性能优化**：优化查询性能和数据结构
- **迁移脚本**：`src/scripts/db-migration/1.6/20250415-openai-gpt41.sql`

### 11) 预设应用修复

- 修复应用预设时的 500 错误（`apply-preset 500 issue`）

### 12) 版本检查优化

- 当最新版本解析失败时不总是抛出错误（`not always throw error when latest version failed to parse`）
- 改进版本检查的容错性

### 13) 问题修复（小版本）

**1.0.1 版本修复**：
- 修复默认推理级别导致无法聊天的问题（`fix default reasoning effort causing unable chat`）
- 修复 CI/CD 变更日志不包含的问题（`fix cicd changeslogs not contained issue`）

**1.0.2 版本修复**：
- 修复 Google Gemini 推理级别问题（`fix google gemini reasoning effort issue`）
- 修复非思考模型问题（`non thinking model issue`）

---

## 数据库迁移

### 迁移要求

本版本需要执行数据库迁移脚本，**升级前务必备份数据库**。

### 迁移脚本

**SQL Server**：
- `src/scripts/db-migration/1.6/20250415-openai-gpt41.sql`
- GitHub 链接：https://github.com/sdcb/chats/blob/ca074bc3811d7279d7f8d55e7b315b3c7dd5f0b9/src/scripts/db-migration/2025/20250415-openai-gpt41.sql

**SQLite**：
- Gist 链接：https://gist.github.com/sdcb/6bc67b188849cdcb0ec8409fb5df8a9e

### 迁移内容

- 新增 GPT-4.1 系列模型引用（3 个模型 × 3 个提供商）
- 新增 o3/o4-mini 推理模型引用（2 个模型 × 2-3 个提供商）
- 新增豆包 1.5 系列模型引用（5 个模型）
- 新增 Gemini 2.5 Flash 模型引用
- 更新模型定价、上下文窗口、最大响应 tokens 等配置

---

## 技术改进

### CI/CD 流程优化

- 采用语义化版本号（Semantic Versioning）
- 修复 CI/CD 中获取变更部分的逻辑（`fix get changes section in cicd`）
- 修复变更日志不包含的问题
- 避免 Windows 构建中的换行符问题（`avoid linebreak in windows build`）
- 测试构建所有 Docker 镜像（`test build all dockers`）
- 将 `build-fe` 添加到必需步骤中
- 使用非过时方法（`use non obsolete`）
- 修正多个作业间的环境变量共享（通过 step outputs）
- 修正语义化版本变量（`correct semantic version variable`）

### 版本号管理

- 从 `AssemblyFileVersion` 获取版本号
- 修复次要完整版本问题（`fix minor full version`）
- 移除额外引号
- 添加 `r-RN` 作为 Docker 镜像标签

---

## Docker 镜像

支持多平台 Docker 镜像：

| 描述                             | Docker 镜像                                    |
| ------------------------------- | --------------------------------------------- |
| Linux x64                       | `docker.io/sdcb/chats:1.0.0.756-linux-x64`    |
| Linux ARM64                     | `docker.io/sdcb/chats:1.0.0.756-linux-arm64`  |
| Windows Nano Server 1809        | `docker.io/sdcb/chats:1.0.0.756-nanoserver-1809` |
| Windows Nano Server LTSC 2022   | `docker.io/sdcb/chats:1.0.0.756-nanoserver-ltsc2022` |
| Windows Nano Server LTSC 2025   | `docker.io/sdcb/chats:1.0.0.756-nanoserver-ltsc2025` |
| Latest                          | `docker.io/sdcb/chats:latest`                 |

---

## 升级指南

### 升级步骤

1. **备份数据**：升级前务必备份数据库和配置文件
2. **停止服务**：停止当前运行的 Chats 服务
3. **执行迁移**：根据使用的数据库类型（SQL Server/SQLite）执行对应的迁移脚本
4. **更新程序**：替换为新版本的可执行文件或 Docker 镜像
5. **启动服务**：启动新版本服务并验证功能

### Docker 升级

```bash
# 拉取最新镜像
docker pull sdcb/chats:1.0.0.756-linux-x64

# 或使用 latest 标签
docker pull sdcb/chats:latest

# 重新启动容器
docker-compose up -d
```

### 二进制文件升级

下载对应平台的二进制文件：
- Windows x64：`chats-win-x64.zip`
- Linux x64：`chats-linux-x64.zip`
- Linux ARM64：`chats-linux-arm64.zip`
- macOS ARM64：`chats-osx-arm64.zip`
- macOS x64：`chats-osx-x64.zip`

国内用户可使用加速下载链接：`https://io.starworks.cc:88/chats/r756/[文件名]`

---

## 已知问题

### 1.0.1 修复的问题
- 默认推理级别配置导致聊天功能无法使用

### 1.0.2 修复的问题
- Google Gemini 模型的推理级别设置不正确
- 非思考模型在某些场景下的行为异常

---

## 致谢

我们衷心感谢广大用户和技术伙伴长期以来的支持与反馈！Chats 1.0 的推出，旨在为您提供更高效、便捷且智能的聊天前端体验。未来我们将持续迭代更新，带来更多创新功能。欢迎您持续关注并体验我们的新版本！

---

## 完整变更日志

### 1.0.0 (756) - 2025-04-21

主要提交（精选）：
- allow non-admin user for admin usage page
- increase network timeout for google gemini to 24 hours
- fix response speed issues
- fix toFixed issues
- upgrade deps, gemini supports reasoning effort
- add gemini 2.5 flash
- add balance display/ fix url issues
- increase timeout to 24 hours, disable cancellation token for chat
- fix EF date translate issue
- avoid kv model in statistics response
- add statistics controller
- rename grok shortname as grok-3
- azure openai follow the 1 hour network timeout
- fix div 0 issue
- add admin usage page
- add usage stat
- add pagination number
- add usage stat api
- not always throw error when latest version failed to parse
- optimize prompt tab
- update useTranslation hooks
- set 401 not show message
- fix apply-preset 500 issue
- add doubao 1.5 new models
- move usage page to tab
- add back r-RN as docker image tag
- add o3/o4-mini support
- fix usage time query issue
- support session in url
- fix shared message display issues
- export file method to get
- page send mutiple request
- fix modal display issues
- add export excel and format date
- add gpt-4.1 mini/nano for azure/github models
- fix excel export issue
- remove extra quote
- fix minor full version
- show tags as groups
- fix get changes section in cicd
- avoid linebreak in windows build
- test build all dockers
- add build-fe into required need step
- use non obsolete
- try correct multiple jobs ENV share by step outputs
- correct semantic version variable
- using semantic version cicd
- fix usage api prompt 500 if kid is null
- get version from AssemblyFileVersion

完整对比：https://github.com/sdcb/chats/compare/r-693...1.0.0.756

### 1.0.1 (759) - 2025-04-22

- fix default reasoning effort causing unable chat
- fix cicd changeslogs not contained issue

完整对比：https://github.com/sdcb/chats/compare/1.0.0.756...1.0.1.759

### 1.0.2 (762) - 2025-04-22

- fix google gemini reasoning effort issue/non thinking model issue

完整对比：https://github.com/sdcb/chats/compare/1.0.1.759...1.0.2.762

---

## 相关链接

- GitHub 仓库：https://github.com/sdcb/chats
- 发布页面：https://github.com/sdcb/chats/releases
- 文档中心：https://github.com/sdcb/chats/tree/master/doc
- 问题反馈：https://github.com/sdcb/chats/issues
